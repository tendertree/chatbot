import supabase from "@/src/server/supabase";
import { TogetherManager } from "@/src/server/together";

const TestbucketName = "StudyData"
const TestdocumentName = "go.pdf"

const apiKey = process.env.TOGETHER_KEY;
if (!apiKey) {
    throw new Error('TOGETHER_KEY is not set in environment variables');
}
togetherManager = new TogetherManager(apiKey);

export async function GET(request: Request) {

    const apiKey = process.env.TOGETHER_KEY;
    if (!apiKey) {
        throw new Error('TOGETHER_KEY is not set in environment variables');
    }
    togetherManager = new TogetherManager(apiKey);

    await togetherManager.createIndex(bucketName, documentPath);

    // 吏덈Ц ?앹꽦
    const question = "?꾨? 泥좏븰??硫붿빞?섎뒗 臾댁뾿??二쇱옣?덉뼱?";

    // 臾몄꽌 荑쇰━
    const { response, sourceNodes } = await togetherManager.queryDocument(question);

    return Response.json(node);
}
